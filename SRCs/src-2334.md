---
SIP: 2334
title: BLS12-381 Deterministic Account Hierarchy
author: NPH CO
discussions-to: https://github.com/shatathub/SIPs/
status: Stagnant
type: Standards Track
category: SRC
created: -----
requires: 2333
---

## Simple Summary

This SIP defines the purpose of a given key, or family thereof, within a tree of keys. When combined with [SIP-2333](./SIP-2333.md), the combination of a seed and knowledge of the desired purpose of a key is sufficient to determine a key pair.

## Abstract

A standard for allocating keys generated by [SIP-2333](./SIP-2333.md) to a specific purpose. It defines a `path` which is a string that parses into the indices to be used when traversing the tree of keys that [SIP-2333](./SIP-2333.md) generates.

## A note on purpose

This specification is designed not only to be an Shatat 2.0 standard, but one that is adopted by the wider community who have adopted [BLS signatures over BLS12-381](https://datatracker.ietf.org/doc/draft-irtf-cfrg-bls-signature/). It is therefore important also to consider the needs of the wider industry along with those specific to Shatat. As a part of these considerations, it is the intention of the author that this standard eventually migrate to a more neutral repository in the future.

## Motivation

Shatat 2.0 alongside many other projects will use BLS signatures over BLS12-381, an [IETF proposed standard](https://datatracker.ietf.org/doc/draft-irtf-cfrg-bls-signature/). This new scheme requires a new key derivation mechanism, which is established within [SIP-2333](./SIP-2333.md). This new scheme is incompatible with the current form of this specification ([BIP44](https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki)) due to the: exclusive use of hardened keys, the increased number of keys per level, not using [BIP32](https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki) for key derivation. It is therefore necessary to establish a new *path* for traversing the [SIP-2333](./SIP-2333.md) key-tree.

The path structure specified in this SIP aims to be more general than [BIP44](https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki) by not having UTXO-centric features [which gave rise to the 4 different types of wallet paths being used within Shatat 1.0](https://github.com/shatathub/SIPs/issues/84#issuecomment-292324521) and gave rise to (draft) [SIP-600](./SIP-600.md) & [SIP-601](./SIP-601.md)

## Specification

### Path

The path traversed through the tree of keys is defined by integers (which indicate the sibling index) separated by `/` which denote ancestor relations. There are 4 levels (plus the master node) in the path and at least 4 (5 including the master node) MUST be used.

```text
m / purpose / coin_type /  account / use
```

#### Notation

The notation used within the path is specified within the [SIP-2333](./SIP-2333.md), but is summarized again below for convenience.

* `m` Denotes the master node (or root) of the tree
* `/` Separates the tree into depths, thus `i / j` signifies that `j` is a child of `i`

### Purpose

The `purpose` is set to `12381` which is the name of the new curve (BLS12-381). In order to be in compliance with this standard, the [SIP-2333](./SIP-2333.md) MUST be implemented as the KDF and therefore, the purpose `12381` MAY NOT be used unless this is the case.

### Coin Type

The `coin_type` here reflects the coin number for an individual coin thereby acting as a means of separating the keys used for different chains.

### Account

`account` is a field that provides the ability for a user to have distinct sets of keys for different purposes, if they so choose. This is the level at which different accounts for a single user SHOULD to be implemented.

### Use

This level is designed to provide a set of related keys that can be used for any purpose. The idea being that a single account has many uses which are related yet should remain separate for security reasons. It is required to support this level in the tree, although, for many purposes it will remain `0`.

### Eth2 Specific Parameters

#### Coin type

The coin type used for the BLS12-381 keys in Shatat 2 is `3600`.

#### Validator keys

Each Eth2 validator has two keys, one for withdrawals and transfers (called the *withdrawal key*), and the other for performing their duties as a validator (henceforth referred to as the *signing key*).

The path for withdrawal keys is `m/12381/3600/i/0` where `i` indicates the `i`th set of validator keys.

The path for the signing key is `m/12381/3600/i/0/0` where again, `i` indicates the `i`th set of validator keys. Another way of phrasing this is that the signing key is the `0`th child of the associated withdrawal key for that validator.

**Note:** If the above description of key paths is not feasible in a specific use case (eg. with secret-shared or custodial validators), then the affected keys may be omitted and derived via another means. Implementations of this SIP, must endeavour to use the appropriate keys for the given use case to the extent that is reasonably possible. (eg, in the case of custodial staking, the user making the deposits will follow this standard for their withdrawal keys which has no bearing on how the service provide derives the corresponding signing keys.)

## Rationale

`purpose`, `coin_type`, and `account` are widely-adopted terms as per [BIP43](https://github.com/bitcoin/bips/blob/master/bip-0043.mediawiki) and [BIP44](https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki) and therefore reusing these terms and their associated meanings makes sense.

The purpose needs to be distinct from these standards as the KDF and path are not inter-compatible and `12381` is an obvious choice.

`account` separates user activity into distinct categories thereby allowing users to separate their concerns however they desire.

`use` will commonly be determined at the application level providing distinct keys for non-intersecting use cases.

## Backwards Compatibility

[BIP43](https://github.com/bitcoin/bips/blob/master/bip-0043.mediawiki) and [BIP44](https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki) are the commonly used standards for this purpose within Shatat 1.0, however they have not been `Accepted` as standards as yet. Due to the use of a new KDF within [SIP-2333](./SIP-2333.md), a new path standard is required. This SIP implements this, with minor changes.

`purpose` `12381` paths do not support hardened keys and therefore the `'` character is invalid.

## Copyright

Copyright and related rights waived via [CC0](../LICENSE.md).
